// Generated by Haxe 4.0.0-preview.4+1e3e5e016
(function ($global) { "use strict";
var $hxClasses = {},$estr = function() { return js_Boot.__string_rec(this,''); },$hxEnums = {},$_;
function $extend(from, fields) {
	function Inherit() {} Inherit.prototype = from; var proto = new Inherit();
	for (var name in fields) proto[name] = fields[name];
	if( fields.toString !== Object.prototype.toString ) proto.toString = fields.toString;
	return proto;
}
var mithril_Mithril = function() { };
$hxClasses["mithril.Mithril"] = mithril_Mithril;
mithril_Mithril.__name__ = true;
var Client = function() {
	ClientInit.initApplication();
	this.stateMonitor = new StateMonitor();
	this.developUI = new DevelopUI();
	m.mount(window.document.querySelector("main"),this);
};
$hxClasses["Client"] = Client;
Client.__name__ = true;
Client.__interfaces__ = [mithril_Mithril];
Client.main = function() {
	new Client();
};
Client.prototype = {
	view: function() {
		if(arguments.length > 0 && arguments[0].tag != this) return arguments[0].tag.view.apply(arguments[0].tag, arguments);
		return [this.developUI.view(),this.stateMonitor.view()];
	}
	,__class__: Client
};
var ApiCalls = function() { };
$hxClasses["ApiCalls"] = ApiCalls;
ApiCalls.__name__ = true;
ApiCalls.getUserData = function(token) {
	console.log("src/Client.hx:107:","User token: " + HxOverrides.substr(token == null ? "null" : "" + token,0,20));
	return m.request({ method : "get", url : "/api/userdata", headers : { authorization : "Bearer " + token}});
};
var FirebaseUser = function() { };
$hxClasses["FirebaseUser"] = FirebaseUser;
FirebaseUser.__name__ = true;
FirebaseUser.getCurrentUser = function() {
	return firebase.auth().currentUser;
};
FirebaseUser.getUserToken = function() {
	if(FirebaseUser.getCurrentUser() != null) {
		return FirebaseUser.getCurrentUser().getIdToken();
	} else {
		return new Promise(function(res,rej) {
			rej("Firebase.auth().currentUser == null");
			return;
		});
	}
};
var ClientInit = function() { };
$hxClasses["ClientInit"] = ClientInit;
ClientInit.__name__ = true;
ClientInit.initApplication = function() {
	var app = firebase.initializeApp({ apiKey : "AIzaSyBGLErhUSfQHA4wOtkid206KVE-96QEN04", authDomain : "fb-stack.firebaseapp.com", databaseURL : "https://fb-stack.firebaseio.com", projectId : "fb-stack", storageBucket : "fb-stack.appspot.com", messagingSenderId : "665827748546"});
	app.database().ref("test").on("value",function(snap,str) {
		console.log("src/Client.hx:143:","database value changed:" + Std.string(snap.val()));
		return;
	});
	app.database().ref("site-config").on("value",function(snap1,str1) {
		console.log("src/Client.hx:147:","Site config data:" + Std.string(snap1.val()));
		try {
			if(snap1.val() == null) {
				throw new js__$Boot_HaxeError("No site config data in site-config");
			}
			State.addLog("site-config loaded!");
			State.setSiteConfig(dataclass_JsonConverter.fromJson(domain_SiteConfigData,snap1.val()));
		} catch( e ) {
			State.setErrors(["Can not find site-configx data","" + Std.string((e instanceof js__$Boot_HaxeError) ? e.val : e)]);
		}
		return;
	});
	app.auth().onAuthStateChanged(function(user) {
		if(user != null) {
			State.setUserData(StateMode.Loading);
			return FirebaseUser.getUserToken().then(function(token) {
				return ApiCalls.getUserData(token);
			}).then(function(data) {
				console.log("src/Client.hx:165:",data);
				State.addLog("user loaded!");
				State.setErrors(data.errors);
				var userData = new domain_UserData(data.userData);
				State.setUserData(StateMode.Data(userData));
				var dbref = "user-config/" + utils__$UserEmail_UserEmail_$Impl_$.toPiped(userData.email);
				return app.database().ref(dbref).once("value",function(snap2,str2) {
					console.log("src/Client.hx:174:","user-config loaded! " + Std.string(snap2.val()));
					try {
						if(snap2.val() == null) {
							throw new js__$Boot_HaxeError("Could not load " + dbref);
						}
						State.addLog("user-config loaded: " + Std.string(snap2.val()));
						State.setUserConfig(new domain_UserConfigData(snap2.val()));
					} catch( e1 ) {
						State.setErrors(["" + Std.string((e1 instanceof js__$Boot_HaxeError) ? e1.val : e1)]);
					}
					return;
				});
			})["catch"](function(e2) {
				console.log("src/Client.hx:189:","userData Error:" + e2);
				State.setErrors(["User == null","" + e2]);
				State.setUserData(StateMode.None);
				State.setUserConfig(null);
				return;
			});
		} else {
			console.log("src/Client.hx:196:","user == null");
			State.addLog("User == null");
			State.setUserData(StateMode.None);
			State.setUserConfig(null);
			return null;
		}
	});
};
var DataClass = function() { };
$hxClasses["DataClass"] = DataClass;
DataClass.__name__ = true;
var domain_DomainData = function(data) {
	this.color = "grey";
	this.fullname = "Fullname";
	this.name = "shortname";
	if(data != null) {
		if(Object.prototype.hasOwnProperty.call(data,"name")) {
			this.set_name(data.name);
		}
		if(Object.prototype.hasOwnProperty.call(data,"fullname")) {
			this.set_fullname(data.fullname);
		}
		if(Object.prototype.hasOwnProperty.call(data,"color")) {
			this.set_color(data.color);
		}
	}
};
$hxClasses["domain.DomainData"] = domain_DomainData;
domain_DomainData.__name__ = true;
domain_DomainData.__interfaces__ = [DataClass];
domain_DomainData.prototype = {
	set_name: function(v) {
		if(v == null) {
			throw new js__$Boot_HaxeError("DataClass validation failed for DomainData.name.");
		}
		return this.name = v;
	}
	,set_fullname: function(v) {
		if(v == null) {
			throw new js__$Boot_HaxeError("DataClass validation failed for DomainData.fullname.");
		}
		return this.fullname = v;
	}
	,set_color: function(v) {
		if(v == null) {
			throw new js__$Boot_HaxeError("DataClass validation failed for DomainData.color.");
		}
		return this.color = v;
	}
	,__class__: domain_DomainData
	,__properties__: {set_color:"set_color",set_fullname:"set_fullname",set_name:"set_name"}
};
var domain_SiteConfigData = function(data) {
	this.set_arr(data.arr);
	this.set_domains(data.domains);
};
$hxClasses["domain.SiteConfigData"] = domain_SiteConfigData;
domain_SiteConfigData.__name__ = true;
domain_SiteConfigData.__interfaces__ = [DataClass];
domain_SiteConfigData.validate = function(data) {
	var output = [];
	if(!Object.prototype.hasOwnProperty.call(data,"arr")) {
		output.push("arr");
	} else if(data.arr == null) {
		output.push("arr");
	}
	if(!Object.prototype.hasOwnProperty.call(data,"domains")) {
		output.push("domains");
	} else if(data.domains == null) {
		output.push("domains");
	}
	return output;
};
domain_SiteConfigData.prototype = {
	set_arr: function(v) {
		if(v == null) {
			throw new js__$Boot_HaxeError("DataClass validation failed for SiteConfigData.arr.");
		}
		return this.arr = v;
	}
	,set_domains: function(v) {
		if(v == null) {
			throw new js__$Boot_HaxeError("DataClass validation failed for SiteConfigData.domains.");
		}
		return this.domains = v;
	}
	,__class__: domain_SiteConfigData
	,__properties__: {set_domains:"set_domains",set_arr:"set_arr"}
};
var StateMode = $hxEnums["StateMode"] = { __ename__ : true, __constructs__ : ["None","Loading","Data"]
	,None: {_hx_index:0,__enum__:"StateMode",toString:$estr}
	,Loading: {_hx_index:1,__enum__:"StateMode",toString:$estr}
	,Data: ($_=function(data) { return {_hx_index:2,data:data,__enum__:"StateMode",toString:$estr}; },$_.__params__ = ["data"],$_)
};
var State = function() { };
$hxClasses["State"] = State;
State.__name__ = true;
State.addLog = function(log) {
	State.logs.unshift(log);
	m.redraw();
};
State.setErrors = function(err) {
	Lambda.iter(err,function(e) {
		return State.errors.push(e);
	});
	m.redraw();
};
State.setUserData = function(state) {
	State.userData = state;
	m.redraw();
};
State.setUserConfig = function(config) {
	State.userConfig = config;
	m.redraw();
};
State.setSiteConfig = function(config) {
	State.siteConfig = config;
	m.redraw();
};
var StateMonitor = function() {
};
$hxClasses["StateMonitor"] = StateMonitor;
StateMonitor.__name__ = true;
StateMonitor.__interfaces__ = [mithril_Mithril];
StateMonitor.prototype = {
	view: function() {
		if(arguments.length > 0 && arguments[0].tag != this) return arguments[0].tag.view.apply(arguments[0].tag, arguments);
		return [m.m("div.statelabel","userData:"),m.m("div.stateitems","" + Std.string(State.userData)),m.m("div.statelabel","userConfig"),m.m("div.stateitems","" + Std.string(State.userConfig)),m.m("div.statelabel","siteConfig"),m.m("div.stateitems","" + Std.string(State.siteConfig)),m.m("div.statelabel","logs:"),m.m("div.stateitems",State.logs.map(function(e) {
			return m.m("div.stateitem.statelog","Log:" + e);
		})),m.m("div.statelabel","errors:"),m.m("div.stateitems",State.errors.map(function(e1) {
			return m.m("div.stateitem.stateerror","Error:" + e1);
		}))];
	}
	,__class__: StateMonitor
};
var DevelopUI = function() {
};
$hxClasses["DevelopUI"] = DevelopUI;
DevelopUI.__name__ = true;
DevelopUI.__interfaces__ = [mithril_Mithril];
DevelopUI.prototype = {
	view: function() {
		if(arguments.length > 0 && arguments[0].tag != this) return arguments[0].tag.view.apply(arguments[0].tag, arguments);
		return [m.m("button",{ onclick : function(e) {
			return firebase.auth().signInWithEmailAndPassword("jonasnys@gmail.com","123456");
		}},"Login"),m.m("button",{ onclick : function(e1) {
			return firebase.auth().signOut();
		}},"Logout"),m.m("button",{ onclick : function(e2) {
			return FirebaseUser.getUserToken().then(function(token) {
				return ApiCalls.getUserData(token);
			}).then(function(data) {
				console.log("src/Client.hx:295:","userData result: " + JSON.stringify(data));
				var d = JSON.parse(JSON.stringify(data));
				console.log("src/Client.hx:298:",d.errors);
				var errors = d.errors;
				Lambda.iter(errors,function(e3) {
					State.errors.unshift(e3);
					return;
				});
				return;
			})["catch"](function(error) {
				console.log("src/Client.hx:302:","userData error: " + error);
				return;
			});
		}},"Test /api/userData ")];
	}
	,__class__: DevelopUI
};
var DateTools = function() { };
$hxClasses["DateTools"] = DateTools;
DateTools.__name__ = true;
DateTools.__format_get = function(d,e) {
	switch(e) {
	case "%":
		return "%";
	case "A":
		return DateTools.DAY_NAMES[d.getDay()];
	case "B":
		return DateTools.MONTH_NAMES[d.getMonth()];
	case "C":
		return StringTools.lpad(Std.string(d.getFullYear() / 100 | 0),"0",2);
	case "D":
		return DateTools.__format(d,"%m/%d/%y");
	case "F":
		return DateTools.__format(d,"%Y-%m-%d");
	case "I":case "l":
		var hour = d.getHours() % 12;
		return StringTools.lpad(Std.string(hour == 0 ? 12 : hour),e == "I" ? "0" : " ",2);
	case "M":
		return StringTools.lpad(Std.string(d.getMinutes()),"0",2);
	case "R":
		return DateTools.__format(d,"%H:%M");
	case "S":
		return StringTools.lpad(Std.string(d.getSeconds()),"0",2);
	case "T":
		return DateTools.__format(d,"%H:%M:%S");
	case "Y":
		return Std.string(d.getFullYear());
	case "a":
		return DateTools.DAY_SHORT_NAMES[d.getDay()];
	case "b":case "h":
		return DateTools.MONTH_SHORT_NAMES[d.getMonth()];
	case "d":
		return StringTools.lpad(Std.string(d.getDate()),"0",2);
	case "e":
		return Std.string(d.getDate());
	case "H":case "k":
		return StringTools.lpad(Std.string(d.getHours()),e == "H" ? "0" : " ",2);
	case "m":
		return StringTools.lpad(Std.string(d.getMonth() + 1),"0",2);
	case "n":
		return "\n";
	case "p":
		if(d.getHours() > 11) {
			return "PM";
		} else {
			return "AM";
		}
		break;
	case "r":
		return DateTools.__format(d,"%I:%M:%S %p");
	case "s":
		return Std.string(d.getTime() / 1000 | 0);
	case "t":
		return "\t";
	case "u":
		var t = d.getDay();
		if(t == 0) {
			return "7";
		} else if(t == null) {
			return "null";
		} else {
			return "" + t;
		}
		break;
	case "w":
		return Std.string(d.getDay());
	case "y":
		return StringTools.lpad(Std.string(d.getFullYear() % 100),"0",2);
	default:
		throw new js__$Boot_HaxeError("Date.format %" + e + "- not implemented yet.");
	}
};
DateTools.__format = function(d,f) {
	var r_b = "";
	var p = 0;
	while(true) {
		var np = f.indexOf("%",p);
		if(np < 0) {
			break;
		}
		var len = np - p;
		r_b += len == null ? HxOverrides.substr(f,p,null) : HxOverrides.substr(f,p,len);
		r_b += Std.string(DateTools.__format_get(d,HxOverrides.substr(f,np + 1,1)));
		p = np + 2;
	}
	var len1 = f.length - p;
	r_b += len1 == null ? HxOverrides.substr(f,p,null) : HxOverrides.substr(f,p,len1);
	return r_b;
};
DateTools.format = function(d,f) {
	return DateTools.__format(d,f);
};
var HxOverrides = function() { };
$hxClasses["HxOverrides"] = HxOverrides;
HxOverrides.__name__ = true;
HxOverrides.strDate = function(s) {
	switch(s.length) {
	case 8:
		var k = s.split(":");
		var d = new Date();
		d["setTime"](0);
		d["setUTCHours"](k[0]);
		d["setUTCMinutes"](k[1]);
		d["setUTCSeconds"](k[2]);
		return d;
	case 10:
		var k1 = s.split("-");
		return new Date(k1[0],k1[1] - 1,k1[2],0,0,0);
	case 19:
		var k2 = s.split(" ");
		var y = k2[0].split("-");
		var t = k2[1].split(":");
		return new Date(y[0],y[1] - 1,y[2],t[0],t[1],t[2]);
	default:
		throw new js__$Boot_HaxeError("Invalid date format : " + s);
	}
};
HxOverrides.cca = function(s,index) {
	var x = s.charCodeAt(index);
	if(x != x) {
		return undefined;
	}
	return x;
};
HxOverrides.substr = function(s,pos,len) {
	if(len == null) {
		len = s.length;
	} else if(len < 0) {
		if(pos == 0) {
			len = s.length + len;
		} else {
			return "";
		}
	}
	return s.substr(pos,len);
};
HxOverrides.iter = function(a) {
	return { cur : 0, arr : a, hasNext : function() {
		return this.cur < this.arr.length;
	}, next : function() {
		return this.arr[this.cur++];
	}};
};
var Lambda = function() { };
$hxClasses["Lambda"] = Lambda;
Lambda.__name__ = true;
Lambda.has = function(it,elt) {
	var x = $getIterator(it);
	while(x.hasNext()) if(x.next() == elt) {
		return true;
	}
	return false;
};
Lambda.iter = function(it,f) {
	var x = $getIterator(it);
	while(x.hasNext()) f(x.next());
};
Math.__name__ = true;
var Reflect = function() { };
$hxClasses["Reflect"] = Reflect;
Reflect.__name__ = true;
Reflect.field = function(o,field) {
	try {
		return o[field];
	} catch( e ) {
		return null;
	}
};
Reflect.setProperty = function(o,field,value) {
	var tmp;
	var tmp1;
	if(o.__properties__) {
		tmp = o.__properties__["set_" + field];
		tmp1 = tmp;
	} else {
		tmp1 = false;
	}
	if(tmp1) {
		o[tmp](value);
	} else {
		o[field] = value;
	}
};
Reflect.fields = function(o) {
	var a = [];
	if(o != null) {
		var hasOwnProperty = Object.prototype.hasOwnProperty;
		for( var f in o ) {
		if(f != "__id__" && f != "hx__closures__" && hasOwnProperty.call(o,f)) {
			a.push(f);
		}
		}
	}
	return a;
};
Reflect.isFunction = function(f) {
	if(typeof(f) == "function") {
		return !(f.__name__ || f.__ename__);
	} else {
		return false;
	}
};
var Std = function() { };
$hxClasses["Std"] = Std;
Std.__name__ = true;
Std.string = function(s) {
	return js_Boot.__string_rec(s,"");
};
Std.parseInt = function(x) {
	var v = parseInt(x,10);
	if(v == 0 && (HxOverrides.cca(x,1) == 120 || HxOverrides.cca(x,1) == 88)) {
		v = parseInt(x);
	}
	if(isNaN(v)) {
		return null;
	}
	return v;
};
var StringTools = function() { };
$hxClasses["StringTools"] = StringTools;
StringTools.__name__ = true;
StringTools.startsWith = function(s,start) {
	if(s.length >= start.length) {
		return HxOverrides.substr(s,0,start.length) == start;
	} else {
		return false;
	}
};
StringTools.endsWith = function(s,end) {
	var elen = end.length;
	var slen = s.length;
	if(slen >= elen) {
		return HxOverrides.substr(s,slen - elen,elen) == end;
	} else {
		return false;
	}
};
StringTools.isSpace = function(s,pos) {
	var c = HxOverrides.cca(s,pos);
	if(!(c > 8 && c < 14)) {
		return c == 32;
	} else {
		return true;
	}
};
StringTools.ltrim = function(s) {
	var l = s.length;
	var r = 0;
	while(r < l && StringTools.isSpace(s,r)) ++r;
	if(r > 0) {
		return HxOverrides.substr(s,r,l - r);
	} else {
		return s;
	}
};
StringTools.rtrim = function(s) {
	var l = s.length;
	var r = 0;
	while(r < l && StringTools.isSpace(s,l - r - 1)) ++r;
	if(r > 0) {
		return HxOverrides.substr(s,0,l - r);
	} else {
		return s;
	}
};
StringTools.trim = function(s) {
	return StringTools.ltrim(StringTools.rtrim(s));
};
StringTools.lpad = function(s,c,l) {
	if(c.length <= 0) {
		return s;
	}
	while(s.length < l) s = c + s;
	return s;
};
StringTools.replace = function(s,sub,by) {
	return s.split(sub).join(by);
};
var Type = function() { };
$hxClasses["Type"] = Type;
Type.__name__ = true;
Type.createInstance = function(cl,args) {
	return new (Function.prototype.bind.apply(cl,[null].concat(args)));
};
Type.createEnum = function(e,constr,params) {
	var f = Reflect.field(e,constr);
	if(f == null) {
		throw new js__$Boot_HaxeError("No such constructor " + constr);
	}
	if(Reflect.isFunction(f)) {
		if(params == null) {
			throw new js__$Boot_HaxeError("Constructor " + constr + " need parameters");
		}
		return f.apply(e,params);
	}
	if(params != null && params.length != 0) {
		throw new js__$Boot_HaxeError("Constructor " + constr + " does not need parameters");
	}
	return f;
};
var dataclass_CircularReferenceHandling = $hxEnums["dataclass.CircularReferenceHandling"] = { __ename__ : true, __constructs__ : ["ThrowException","SetToNull","TrackReferences"]
	,ThrowException: {_hx_index:0,__enum__:"dataclass.CircularReferenceHandling",toString:$estr}
	,SetToNull: {_hx_index:1,__enum__:"dataclass.CircularReferenceHandling",toString:$estr}
	,TrackReferences: {_hx_index:2,__enum__:"dataclass.CircularReferenceHandling",toString:$estr}
};
var dataclass_Rtti = function() { };
$hxClasses["dataclass.Rtti"] = dataclass_Rtti;
dataclass_Rtti.__name__ = true;
dataclass_Rtti.rttiData = function(cls) {
	return haxe_rtti_Meta.getType(cls)["dataClassRtti"][0];
};
var haxe_IMap = function() { };
$hxClasses["haxe.IMap"] = haxe_IMap;
haxe_IMap.__name__ = true;
var haxe_ds_StringMap = function() {
	this.h = { };
};
$hxClasses["haxe.ds.StringMap"] = haxe_ds_StringMap;
haxe_ds_StringMap.__name__ = true;
haxe_ds_StringMap.__interfaces__ = [haxe_IMap];
haxe_ds_StringMap.prototype = {
	setReserved: function(key,value) {
		if(this.rh == null) {
			this.rh = { };
		}
		this.rh["$" + key] = value;
	}
	,getReserved: function(key) {
		if(this.rh == null) {
			return null;
		} else {
			return this.rh["$" + key];
		}
	}
	,existsReserved: function(key) {
		if(this.rh == null) {
			return false;
		}
		return this.rh.hasOwnProperty("$" + key);
	}
	,__class__: haxe_ds_StringMap
};
var dataclass_Converter = function(options) {
	if(options == null) {
		options = { };
	}
	this.valueConverters = new haxe_ds_StringMap();
	var this1 = this.valueConverters;
	var value = new dataclass_DateValueConverter(Object.prototype.hasOwnProperty.call(options,"dateFormat") ? options.dateFormat : "%Y-%m-%dT%H:%M:%SZ");
	var _this = this1;
	if(__map_reserved["Date"] != null) {
		_this.setReserved("Date",value);
	} else {
		_this.h["Date"] = value;
	}
	this.circularReferences = Object.prototype.hasOwnProperty.call(options,"circularReferences") ? options.circularReferences : dataclass_CircularReferenceHandling.ThrowException;
};
$hxClasses["dataclass.Converter"] = dataclass_Converter;
dataclass_Converter.__name__ = true;
dataclass_Converter.enumType = function(name) {
	var _this = dataclass_Converter.enumCache;
	if(__map_reserved[name] != null ? _this.existsReserved(name) : _this.h.hasOwnProperty(name)) {
		var _this1 = dataclass_Converter.enumCache;
		if(__map_reserved[name] != null) {
			return _this1.getReserved(name);
		} else {
			return _this1.h[name];
		}
	}
	var output = $hxEnums[name];
	if(output == null) {
		throw new js__$Boot_HaxeError("Enum not found: " + name);
	}
	var _this2 = dataclass_Converter.enumCache;
	if(__map_reserved[name] != null) {
		_this2.setReserved(name,output);
	} else {
		_this2.h[name] = output;
	}
	return output;
};
dataclass_Converter.classType = function(name) {
	var _this = dataclass_Converter.classCache;
	if(__map_reserved[name] != null ? _this.existsReserved(name) : _this.h.hasOwnProperty(name)) {
		var _this1 = dataclass_Converter.classCache;
		if(__map_reserved[name] != null) {
			return _this1.getReserved(name);
		} else {
			return _this1.h[name];
		}
	}
	var output = $hxClasses[name];
	if(output == null) {
		throw new js__$Boot_HaxeError("Class not found: " + name);
	}
	var _this2 = dataclass_Converter.classCache;
	if(__map_reserved[name] != null) {
		_this2.setReserved(name,output);
	} else {
		_this2.h[name] = output;
	}
	return output;
};
dataclass_Converter.prototype = {
	toDataClass: function(cls,json) {
		var refCount = new haxe_ds_IntMap();
		var refAssign = new haxe_ds_IntMap();
		var output = this._toDataClass(cls,json,refCount,refAssign);
		this.assignReferences(refCount,refAssign);
		return output;
	}
	,assignReferences: function(refCount,refAssign) {
		var refId = refAssign.keys();
		while(refId.hasNext()) {
			var refId1 = refId.next();
			var _g = 0;
			var _g1 = refAssign.h[refId1];
			while(_g < _g1.length) {
				var data = _g1[_g];
				++_g;
				Reflect.setProperty(refCount.h[refId1],data.field,refCount.h[data.obj]);
			}
		}
	}
	,_toAnonymousStructure: function(cls,inputData,refCount,refAssign,currentId,toDataClass) {
		var rtti = dataclass_Rtti.rttiData(cls);
		var outputData = { };
		if(this.circularReferences == dataclass_CircularReferenceHandling.TrackReferences && !toDataClass && Object.prototype.hasOwnProperty.call(inputData,"$id")) {
			currentId = inputData["$id"];
		}
		var _g = 0;
		var _g1 = Reflect.fields(rtti);
		while(_g < _g1.length) {
			var field = _g1[_g];
			++_g;
			if(Object.prototype.hasOwnProperty.call(inputData,field)) {
				var input = inputData[field];
				if(this.circularReferences == dataclass_CircularReferenceHandling.TrackReferences && input != null && StringTools.startsWith(rtti[field],"DataClass<") && Object.prototype.hasOwnProperty.call(input,"$ref")) {
					var refData = { obj : Reflect.field(input,"$ref"), field : field};
					if(!refAssign.h.hasOwnProperty(currentId)) {
						refAssign.h[currentId] = [refData];
					} else {
						refAssign.h[currentId].push(refData);
					}
				} else {
					outputData[field] = this.toField(rtti[field],input,refCount,refAssign,toDataClass);
				}
			}
		}
		if(this.circularReferences == dataclass_CircularReferenceHandling.TrackReferences && !toDataClass && currentId > 0) {
			refCount.h[currentId] = outputData;
		}
		return outputData;
	}
	,_toDataClass: function(cls,json,refCount,refAssign) {
		var inputData = json;
		var currentId = 0;
		if(this.circularReferences == dataclass_CircularReferenceHandling.TrackReferences && Object.prototype.hasOwnProperty.call(inputData,"$id")) {
			currentId = inputData["$id"];
		}
		var output = Type.createInstance(cls,[this._toAnonymousStructure(cls,inputData,refCount,refAssign,currentId,true)]);
		if(currentId > 0 && this.circularReferences == dataclass_CircularReferenceHandling.TrackReferences) {
			refCount.h[currentId] = output;
		}
		return output;
	}
	,toField: function(data,value,refCount,refAssign,toDataClass) {
		if(value == null) {
			if(StringTools.startsWith(data,"Option<")) {
				return haxe_ds_Option.None;
			} else {
				return value;
			}
		}
		var _this = this.valueConverters;
		if(__map_reserved[data] != null ? _this.existsReserved(data) : _this.h.hasOwnProperty(data)) {
			var _this1 = this.valueConverters;
			return (__map_reserved[data] != null ? _this1.getReserved(data) : _this1.h[data]).input(value);
		} else if(Lambda.has(dataclass_Converter.directConversions,data)) {
			return value;
		} else if(StringTools.startsWith(data,"Array<")) {
			var arrayType = data.substring(6,data.length - 1);
			var _g = [];
			var _g1 = 0;
			var _g2 = js_Boot.__cast(value , Array);
			while(_g1 < _g2.length) _g.push(this.toField(arrayType,_g2[_g1++],refCount,refAssign,toDataClass));
			return _g;
		} else if(StringTools.startsWith(data,"Enum<")) {
			return Type.createEnum(dataclass_Converter.enumType(data.substring(5,data.length - 1)),value);
		} else if(StringTools.startsWith(data,"DataClass<")) {
			var classT = dataclass_Converter.classType(data.substring(10,data.length - 1));
			if(toDataClass) {
				return this._toDataClass(classT,value,refCount,refAssign);
			} else {
				return this._toAnonymousStructure(classT,value,refCount,refAssign,0,toDataClass);
			}
		} else if(StringTools.startsWith(data,"Option<")) {
			return haxe_ds_Option.Some(this.toField(data.substring(7,data.length - 1),value,refCount,refAssign,toDataClass));
		} else if(StringTools.startsWith(data,"StringMap<")) {
			var mapType = data.substring(10,data.length - 1);
			var output = new haxe_ds_StringMap();
			var object = value;
			var _g3 = 0;
			var _g11 = Reflect.fields(object);
			while(_g3 < _g11.length) {
				var key = _g11[_g3];
				++_g3;
				var value1 = this.toField(mapType,object[key],refCount,refAssign,toDataClass);
				if(__map_reserved[key] != null) {
					output.setReserved(key,value1);
				} else {
					output.h[key] = value1;
				}
			}
			return output;
		} else if(StringTools.startsWith(data,"IntMap<")) {
			var mapType1 = data.substring(7,data.length - 1);
			var output1 = new haxe_ds_IntMap();
			var object1 = value;
			var _g4 = 0;
			var _g12 = Reflect.fields(object1);
			while(_g4 < _g12.length) {
				var key1 = _g12[_g4];
				++_g4;
				var key2 = Std.parseInt(key1);
				var value2 = this.toField(mapType1,object1[key1],refCount,refAssign,toDataClass);
				output1.h[key2] = value2;
			}
			return output1;
		} else {
			throw new js__$Boot_HaxeError("Unsupported DataClass converter: " + data);
		}
	}
	,__class__: dataclass_Converter
};
var dataclass_DateValueConverter = function(format) {
	this.format = format;
};
$hxClasses["dataclass.DateValueConverter"] = dataclass_DateValueConverter;
dataclass_DateValueConverter.__name__ = true;
dataclass_DateValueConverter.getTimeZone = function() {
	var now = new Date();
	now = new Date(now.getFullYear(),now.getMonth(),now.getDate(),0,0,0);
	return 86400000. * Math.round(now.getTime() / 24 / 3600 / 1000) - now.getTime();
};
dataclass_DateValueConverter.prototype = {
	input: function(input) {
		var s = StringTools.trim(input);
		if(StringTools.endsWith(s,"Z")) {
			return new Date(s);
		}
		return HxOverrides.strDate(s);
	}
	,output: function(input) {
		var time;
		if(StringTools.endsWith(this.format,"Z")) {
			var t = -dataclass_DateValueConverter.getTimeZone();
			time = new Date(input.getTime() + t);
		} else {
			time = input;
		}
		return DateTools.format(time,this.format);
	}
	,__class__: dataclass_DateValueConverter
};
var dataclass_JsonConverter = function(options) {
	dataclass_Converter.call(this,options);
};
$hxClasses["dataclass.JsonConverter"] = dataclass_JsonConverter;
dataclass_JsonConverter.__name__ = true;
dataclass_JsonConverter.fromJson = function(cls,json) {
	return dataclass_JsonConverter.current.toDataClass(cls,json);
};
dataclass_JsonConverter.__super__ = dataclass_Converter;
dataclass_JsonConverter.prototype = $extend(dataclass_Converter.prototype,{
	__class__: dataclass_JsonConverter
});
var domain_UserData = function(data) {
	this.domains = ["kak","kantor"];
	this.access = "admin";
	this.set_firstname(data.firstname);
	this.set_lastname(data.lastname);
	this.set_email(data.email);
	if(Object.prototype.hasOwnProperty.call(data,"access")) {
		this.set_access(data.access);
	}
	if(Object.prototype.hasOwnProperty.call(data,"domains")) {
		this.set_domains(data.domains);
	}
};
$hxClasses["domain.UserData"] = domain_UserData;
domain_UserData.__name__ = true;
domain_UserData.__interfaces__ = [DataClass];
domain_UserData.fromJson = function(json) {
	return dataclass_JsonConverter.fromJson(domain_UserData,json);
};
domain_UserData.validate = function(data) {
	var output = [];
	if(!Object.prototype.hasOwnProperty.call(data,"firstname")) {
		output.push("firstname");
	} else if(data.firstname == null) {
		output.push("firstname");
	}
	if(!Object.prototype.hasOwnProperty.call(data,"lastname")) {
		output.push("lastname");
	} else if(data.lastname == null) {
		output.push("lastname");
	}
	if(!Object.prototype.hasOwnProperty.call(data,"email")) {
		output.push("email");
	} else if(data.email == null) {
		output.push("email");
	}
	return output;
};
domain_UserData.prototype = {
	set_firstname: function(v) {
		if(v == null) {
			throw new js__$Boot_HaxeError("DataClass validation failed for UserData.firstname.");
		}
		return this.firstname = v;
	}
	,set_lastname: function(v) {
		if(v == null) {
			throw new js__$Boot_HaxeError("DataClass validation failed for UserData.lastname.");
		}
		return this.lastname = v;
	}
	,set_email: function(v) {
		if(v == null) {
			throw new js__$Boot_HaxeError("DataClass validation failed for UserData.email.");
		}
		return this.email = v;
	}
	,set_access: function(v) {
		if(v == null) {
			throw new js__$Boot_HaxeError("DataClass validation failed for UserData.access.");
		}
		return this.access = v;
	}
	,set_domains: function(v) {
		if(v == null) {
			throw new js__$Boot_HaxeError("DataClass validation failed for UserData.domains.");
		}
		return this.domains = v;
	}
	,__class__: domain_UserData
	,__properties__: {set_domains:"set_domains",set_access:"set_access",set_email:"set_email",set_lastname:"set_lastname",set_firstname:"set_firstname"}
};
var domain_UserConfigData = function(data) {
	this.set_domain(data.domain);
};
$hxClasses["domain.UserConfigData"] = domain_UserConfigData;
domain_UserConfigData.__name__ = true;
domain_UserConfigData.__interfaces__ = [DataClass];
domain_UserConfigData.prototype = {
	set_domain: function(v) {
		if(v == null) {
			throw new js__$Boot_HaxeError("DataClass validation failed for UserConfigData.domain.");
		}
		return this.domain = v;
	}
	,__class__: domain_UserConfigData
	,__properties__: {set_domain:"set_domain"}
};
var haxe_ds_IntMap = function() {
	this.h = { };
};
$hxClasses["haxe.ds.IntMap"] = haxe_ds_IntMap;
haxe_ds_IntMap.__name__ = true;
haxe_ds_IntMap.__interfaces__ = [haxe_IMap];
haxe_ds_IntMap.prototype = {
	keys: function() {
		var a = [];
		for( var key in this.h ) if(this.h.hasOwnProperty(key)) {
			a.push(key | 0);
		}
		return HxOverrides.iter(a);
	}
	,__class__: haxe_ds_IntMap
};
var haxe_ds_Option = $hxEnums["haxe.ds.Option"] = { __ename__ : true, __constructs__ : ["Some","None"]
	,Some: ($_=function(v) { return {_hx_index:0,v:v,__enum__:"haxe.ds.Option",toString:$estr}; },$_.__params__ = ["v"],$_)
	,None: {_hx_index:1,__enum__:"haxe.ds.Option",toString:$estr}
};
var haxe_rtti_Meta = function() { };
$hxClasses["haxe.rtti.Meta"] = haxe_rtti_Meta;
haxe_rtti_Meta.__name__ = true;
haxe_rtti_Meta.getType = function(t) {
	var meta = haxe_rtti_Meta.getMeta(t);
	if(meta == null || meta.obj == null) {
		return { };
	} else {
		return meta.obj;
	}
};
haxe_rtti_Meta.getMeta = function(t) {
	return t.__meta__;
};
var js__$Boot_HaxeError = function(val) {
	Error.call(this);
	this.val = val;
	if(Error.captureStackTrace) {
		Error.captureStackTrace(this,js__$Boot_HaxeError);
	}
};
$hxClasses["js._Boot.HaxeError"] = js__$Boot_HaxeError;
js__$Boot_HaxeError.__name__ = true;
js__$Boot_HaxeError.wrap = function(val) {
	if((val instanceof Error)) {
		return val;
	} else {
		return new js__$Boot_HaxeError(val);
	}
};
js__$Boot_HaxeError.__super__ = Error;
js__$Boot_HaxeError.prototype = $extend(Error.prototype,{
	__class__: js__$Boot_HaxeError
});
var js_Boot = function() { };
$hxClasses["js.Boot"] = js_Boot;
js_Boot.__name__ = true;
js_Boot.getClass = function(o) {
	if((o instanceof Array) && o.__enum__ == null) {
		return Array;
	} else {
		var cl = o.__class__;
		if(cl != null) {
			return cl;
		}
		var name = js_Boot.__nativeClassName(o);
		if(name != null) {
			return js_Boot.__resolveNativeClass(name);
		}
		return null;
	}
};
js_Boot.__string_rec = function(o,s) {
	if(o == null) {
		return "null";
	}
	if(s.length >= 5) {
		return "<...>";
	}
	var t = typeof(o);
	if(t == "function" && (o.__name__ || o.__ename__)) {
		t = "object";
	}
	switch(t) {
	case "function":
		return "<function>";
	case "object":
		if(o.__enum__) {
			var e = $hxEnums[o.__enum__];
			var n = e.__constructs__[o._hx_index];
			var con = e[n];
			if(con.__params__) {
				s += "\t";
				var tmp = n + "(";
				var _g = [];
				var _g1 = 0;
				var _g2 = con.__params__;
				while(_g1 < _g2.length) {
					var p = _g2[_g1];
					++_g1;
					_g.push(js_Boot.__string_rec(o[p],s));
				}
				return tmp + _g.join(",") + ")";
			} else {
				return n;
			}
		}
		if((o instanceof Array)) {
			var l = o.length;
			var i;
			var str = "[";
			s += "\t";
			var _g11 = 0;
			var _g3 = l;
			while(_g11 < _g3) {
				var i1 = _g11++;
				str += (i1 > 0 ? "," : "") + js_Boot.__string_rec(o[i1],s);
			}
			str += "]";
			return str;
		}
		var tostr;
		try {
			tostr = o.toString;
		} catch( e1 ) {
			var e2 = (e1 instanceof js__$Boot_HaxeError) ? e1.val : e1;
			return "???";
		}
		if(tostr != null && tostr != Object.toString && typeof(tostr) == "function") {
			var s2 = o.toString();
			if(s2 != "[object Object]") {
				return s2;
			}
		}
		var k = null;
		var str1 = "{\n";
		s += "\t";
		var hasp = o.hasOwnProperty != null;
		for( var k in o ) {
		if(hasp && !o.hasOwnProperty(k)) {
			continue;
		}
		if(k == "prototype" || k == "__class__" || k == "__super__" || k == "__interfaces__" || k == "__properties__") {
			continue;
		}
		if(str1.length != 2) {
			str1 += ", \n";
		}
		str1 += s + k + " : " + js_Boot.__string_rec(o[k],s);
		}
		s = s.substring(1);
		str1 += "\n" + s + "}";
		return str1;
	case "string":
		return o;
	default:
		return String(o);
	}
};
js_Boot.__interfLoop = function(cc,cl) {
	if(cc == null) {
		return false;
	}
	if(cc == cl) {
		return true;
	}
	var intf = cc.__interfaces__;
	if(intf != null) {
		var _g1 = 0;
		var _g = intf.length;
		while(_g1 < _g) {
			var i = intf[_g1++];
			if(i == cl || js_Boot.__interfLoop(i,cl)) {
				return true;
			}
		}
	}
	return js_Boot.__interfLoop(cc.__super__,cl);
};
js_Boot.__instanceof = function(o,cl) {
	if(cl == null) {
		return false;
	}
	switch(cl) {
	case Array:
		if((o instanceof Array)) {
			return o.__enum__ == null;
		} else {
			return false;
		}
		break;
	case Bool:
		return typeof(o) == "boolean";
	case Dynamic:
		return true;
	case Float:
		return typeof(o) == "number";
	case Int:
		if(typeof(o) == "number") {
			return ((o | 0) === o);
		} else {
			return false;
		}
		break;
	case String:
		return typeof(o) == "string";
	default:
		if(o != null) {
			if(typeof(cl) == "function") {
				if((o instanceof cl)) {
					return true;
				}
				if(js_Boot.__interfLoop(js_Boot.getClass(o),cl)) {
					return true;
				}
			} else if(typeof(cl) == "object" && js_Boot.__isNativeObj(cl)) {
				if((o instanceof cl)) {
					return true;
				}
			}
		} else {
			return false;
		}
		if(cl == Class ? o.__name__ != null : false) {
			return true;
		}
		if(cl == Enum ? o.__ename__ != null : false) {
			return true;
		}
		return $hxEnums[o.__enum__] == cl;
	}
};
js_Boot.__cast = function(o,t) {
	if(js_Boot.__instanceof(o,t)) {
		return o;
	} else {
		throw new js__$Boot_HaxeError("Cannot cast " + Std.string(o) + " to " + Std.string(t));
	}
};
js_Boot.__nativeClassName = function(o) {
	var name = js_Boot.__toStr.call(o).slice(8,-1);
	if(name == "Object" || name == "Function" || name == "Math" || name == "JSON") {
		return null;
	}
	return name;
};
js_Boot.__isNativeObj = function(o) {
	return js_Boot.__nativeClassName(o) != null;
};
js_Boot.__resolveNativeClass = function(name) {
	return $global[name];
};
var utils__$UserEmail_UserEmail_$Impl_$ = {};
$hxClasses["utils._UserEmail.UserEmail_Impl_"] = utils__$UserEmail_UserEmail_$Impl_$;
utils__$UserEmail_UserEmail_$Impl_$.__name__ = true;
utils__$UserEmail_UserEmail_$Impl_$.toPiped = function(this1) {
	var pa = this1;
	pa = StringTools.replace(this1,"@","||");
	pa = StringTools.replace(pa,".","|");
	return pa;
};
function $getIterator(o) { if( o instanceof Array ) return HxOverrides.iter(o); else return o.iterator(); }
$hxClasses["Math"] = Math;
String.prototype.__class__ = $hxClasses["String"] = String;
String.__name__ = true;
$hxClasses["Array"] = Array;
Array.__name__ = true;
Date.prototype.__class__ = $hxClasses["Date"] = Date;
Date.__name__ = ["Date"];
var Int = { };
var Dynamic = { };
var Float = Number;
var Bool = Boolean;
var Class = { };
var Enum = { };
var __map_reserved = {};
Object.defineProperty(js__$Boot_HaxeError.prototype,"message",{ get : function() {
	return String(this.val);
}});
try {
var __varName = window.m;
(function(m) {
			if (m.m) return;
			m.m = function() {
				try { 
					for(var i=0; i < arguments.length; ++i) if(arguments[i] instanceof List) {
						var list = arguments[i].h; arguments[i] = [];
						while(list != null) { arguments[i].push(l[0]); list = l[1]; }
					}
				} catch(e) {}
				return m.apply(this, arguments);
			}
		})(__varName);
} catch(_) {}
try {
GLOBAL.m = require("mithril");
var __varName1 = GLOBAL.m;
(function(m) {
			if (m.m) return;
			m.m = function() {
				try { 
					for(var i=0; i < arguments.length; ++i) if(arguments[i] instanceof List) {
						var list = arguments[i].h; arguments[i] = [];
						while(list != null) { arguments[i].push(l[0]); list = l[1]; }
					}
				} catch(e) {}
				return m.apply(this, arguments);
			}
		})(__varName1);
} catch(_) {}
domain_DomainData.__meta__ = { obj : { dataClassRtti : [{ name : "String", fullname : "String", color : "String"}]}};
domain_SiteConfigData.__meta__ = { obj : { dataClassRtti : [{ arr : "Array<String>", domains : "Array<DataClass<domain.DomainData>>"}]}};
domain_SiteConfigData.defaultValue = new domain_SiteConfigData({ arr : ["A"], domains : [new domain_DomainData({ name : "default-domain", fullname : "Default domain", color : "gray"})]});
State.logs = [];
State.errors = [];
State.userData = StateMode.None;
State.siteConfig = domain_SiteConfigData.defaultValue;
DateTools.DAY_SHORT_NAMES = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
DateTools.DAY_NAMES = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
DateTools.MONTH_SHORT_NAMES = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
DateTools.MONTH_NAMES = ["January","February","March","April","May","June","July","August","September","October","November","December"];
dataclass_Converter.directConversions = ["Int","Bool","Float","String"];
dataclass_Converter.enumCache = new haxe_ds_StringMap();
dataclass_Converter.classCache = new haxe_ds_StringMap();
dataclass_JsonConverter.current = new dataclass_JsonConverter();
domain_UserData.__meta__ = { obj : { dataClassRtti : [{ firstname : "String", lastname : "String", email : "String", access : "String", domains : "Array<String>"}]}};
domain_UserConfigData.__meta__ = { obj : { dataClassRtti : [{ domain : "String"}]}};
js_Boot.__toStr = ({ }).toString;
Client.main();
})(typeof window != "undefined" ? window : typeof global != "undefined" ? global : typeof self != "undefined" ? self : this);
